"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}function mergeConfig(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return _.merge({},e,{types:types,fields:fields})}function temporalTables(e){return _.omitBy(_.mapValues(e,function(e){var t=_.get(e,"_backend",{});return t.temporal?{table:_.get(e,"_backend.collection")}:null}),function(e){return null===e})}function createParameter(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("Parameter");if("WORKFLOW"===r.scope&&"ATTRIBUTE"!==r.class)throw new Error("Workflow parameters can only be of class ATTRIBUTE");return _.includes(["WORKFLOW","TASK"],r.scope)&&(r.mapsTo=null),r.entityType="PARAMETER",l.filter({parentId:r.parentId})("name").coerceTo("array").do(function(e){return a.branch(e.map(function(e){return e.downcase()}).contains(a.expr(r.name).downcase()),a.error("A parameter with the name "+r.name+" already exists on the current "+r.scope),l.insert(r,{returnChanges:!0})("changes").nth(0)("new_val"))}).run(u)}}function isParentPublished(e,t){var r=e.r,n=(e.connection,e.getTypeCollection("Parameter")),o=e.getTypeCollection("Workflow"),a=e.getTypeCollection("Step"),u=e.getTypeCollection("Task");return n.get(t).do(function(e){return r.branch(e.eq(null),r.error("Parameter does not exist"),r.branch(e("scope").eq("WORKFLOW"),o.get(e("parentId")),r.branch(e("scope").eq("TASK"),u.get(e("parentId")),a.get(e("parentId")))).do(function(e){return r.branch(e("_temporal")("version").ne(null),!0,!1)}))})}function updateParameter(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("Parameter");return isParentPublished(e,r.id).branch(a.error("This parameter belongs to a published record and cannot be modified"),l.get(r.id).do(function(e){return a.branch(a.expr(["WORKFLOW","TASK"]).contains(e("scope")),l.get(r.id).update(_.omit(r,"id","mapsTo")).do(function(){return l.get(r.id)}),l.get(r.id).update(_.omit(r,"id")).do(function(){return l.get(r.id)}))})).run(u)}}function deleteParameter(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("Parameter");return isParentPublished(e,r.id).branch(a.error("This parameter belongs to a published record and cannot be deleted"),l.get(r.id).delete().do(function(){return!0})).run(u)}}function createParameterRun(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("Parameter"),i=e.getTypeCollection("ParameterRun");return l.get(r.parameter).eq(null).branch(a.error("Parameter "+r.parameter+" not found"),i.insert(r,{returnChanges:!0})("changes").nth(0)("new_val")).run(u)}}function updateParameterRun(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("ParameterRun");return l.get(r.id).eq(null).branch(a.error("ParameterRun not found"),l.get(r.id).update(_.omit(r,"id")).do(function(){return l.get(r.id)})).run(u)}}function deleteParameterRun(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("ParameterRun");return l.get(r.id).eq(null).branch(a.error("ParameterRun not found"),l.get(r.id).delete().do(function(){return!0})).run(u)}}function updateAttributeValues(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("ParameterRun"),i=e.getTypeCollection("Parameter");return a.expr(r.values).forEach(function(e){return l.get(e("id")).do(function(t){return t.eq(null).branch(a.error("ParameterRun not found"),i.get(t("parameter")).do(function(t){return t.eq(null).or(t("class").ne(ATTRIBUTE)).branch(a.error("Invalid Parameter type"),l.get(e("id")).update({value:e("value")}))}))}).do(function(){return!0})}).run(u)}}function isPublished(e,t,r){var n=e._r,o=e._db.table(e._tables[t].table);return o.get(r).do(function(e){return n.branch(e.eq(null),n.error(t+" does not exist"),n.branch(e("_temporal")("version").ne(null),!0,!1))})}function destroyStep(e,t){var r=e.r,n=(e.connection,e.getTypeCollection("Step")),o=e.getTypeCollection("Parameter");return t=_.isString(t)?[t]:t,n.filter(function(e){return r.expr(t).contains(e("id"))}).delete().do(function(){return o.filter(function(e){return r.expr(t).contains(e("parentId"))}).delete()}).do(function(){return!0})}function createStep(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("Parameter"),i=e.getTypeCollection("Workflow"),s=this.globals._temporal,c=s.createTemporalStep,d=s.filterTemporalTask;if(_.includes(["START","END"],r.type))throw new graphql_error.GraphQLError("A "+r.type+" type can only be added during new workflow creation");if("TASK"===r.type&&!r.task)throw new graphql_error.GraphQLError("A step of type TASK must specifiy a published tasks recordId");return r.entityType="STEP",i.get(r.workflowId).eq(null).branch(a.error("Workflow "+r.workflowId+" does not exist"),a.expr(r.type).ne("TASK").branch(c(r)("changes").nth(0)("new_val"),d({recordId:r.task}).coerceTo("array").do(function(e){return e.count().eq(0).branch(a.error("The task specified does not have a current published version"),c(a.expr(r).merge({source:e.nth(0)("source")}))("changes").nth(0)("new_val"))}))).run(u).then(function(e){return"TASK"!==r.type?e:d({recordId:r.task}).nth(0)("id").do(function(t){return l.filter({parentId:t}).map(function(t){return t.merge({id:a.uuid(),scope:"STEP",parentId:e.id})}).forEach(function(e){return l.insert(e)}).do(function(){return e})}).run(u)})}}function readStepThreads(e){return function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=(arguments[1],arguments.length<=2||void 0===arguments[2]?{}:arguments[2],arguments[3],e.r,e.connection),n=e.getTypeCollection("Step");switch(t.type){case"FORK":return n.filter({fork:t.id}).run(r);default:return[]}}}function readStep(e){return function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=arguments[1],n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],o=(arguments[3],e.r),a=e.connection,u=e.getTypeCollection("Step"),l=this.globals._temporal.filterTemporalStep;if(n.date=r.date||n.date,t.step)return u.get(t.step).run(a);var i=l(r);return t.id&&(i=u.filter({workflowId:t.id}),r.first&&(i=i.filter({type:"START"}).nth(0).do(function(e){return u.get(e("success")).count().eq(0).branch(o.expr([]),o.expr([u.get(e("success"))]))}))),i.coerceTo("array").run(a)}}function updateStep(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("Step");return isPublished(e,"Step",r.id).branch(a.error("This step is published and cannot be modified"),l.get(r.id).update(_.omit(r,"id")).do(function(){return l.get(r.id)})).run(u)}}function deleteStep(e){return function(t,r,n,o){var a=e.r,u=e.connection;return isPublished(e,"Step",r.id).branch(a.error("This step is published and cannot be deleted"),destroyStep(e,r.id)).run(u)}}function readSource(e){return function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=(arguments[1],arguments.length<=2||void 0===arguments[2]?{}:arguments[2]),n=(arguments[3],e.r,e.connection),o=this.globals._temporal.filterTemporalTask;if(t.type!==TASK)return _.get(t,"source",null);var a=_.keys(t.versionArgs).length?t.versionArgs:_.merge(_.omit(r,["id","recordId"]),{recordId:_.get(t,"task",null)});return o(a).coerceTo("array").do(function(e){return e.count().eq(0).branch(null,e.nth(0).hasFields("source").branch(e.nth(0)("source"),null))}).run(n)}}function readStepParams(e){return function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],r=(arguments[1],arguments.length<=2||void 0===arguments[2]?{}:arguments[2]),n=(arguments[3],e.r),o=e.connection,a=this.globals._temporal,u=a.filterTemporalWorkflow,l=a.filterTemporalTask,i=e.getTypeCollection("Parameter");return r=_.omit(r,["recordId","id"]),n.expr(t).do(function(e){return n.expr([WORKFLOW,TASK]).contains(e("type")).branch(e.hasFields("versionArgs").branch(e("versionArgs").keys().count().ne(0).branch(e("versionArgs"),n.expr(r)),n.expr(r)).do(function(t){return n.branch(e("type").eq(WORKFLOW).and(e.hasFields("subWorkflow")),u(t.merge({recordId:e("subWorkflow")})),e("type").eq(TASK).and(e.hasFields("task")),l(t.merge({recordId:e("task")})),n.error("Temporal relation missing reference")).coerceTo("array").do(function(e){return e.count().eq(0).branch(null,e.nth(0)("id"))})}),e("id")).do(function(e){return i.filter({parentId:e}).coerceTo("array")})}).run(o)}}function newStepRun(e,t,r){var n=arguments.length<=3||void 0===arguments[3]||arguments[3],o=arguments.length<=4||void 0===arguments[4]||arguments[4],a=e.r,u=e.getTypeCollection("WorkflowRunThread"),l=e.getTypeCollection("Step"),i=e.getTypeCollection("StepRun"),s=e.getTypeCollection("ParameterRun"),c=e.getTypeCollection("Parameter"),d=e.getTypeCollection("WorkflowRun");return l.get(t.step).do(function(e){return e.eq(null).branch(a.error("Step does not exist"),r)}).do(function(e){return u.get(t.workflowRunThread).do(function(e){return e.eq(null).and(a.expr(o).eq(!0)).branch(a.error("Workflow Run Thread not found"),a.expr(t).hasFields("workflowRun").branch(a.expr(t)("workflowRun"),e("workflowRun")).do(function(e){return e.eq(null).branch(a.error("Unable to determine workflow run ID"),e)}))}).do(function(r){return d.get(r).do(function(o){return o.eq(null).branch(a.error("WorkflowRun not found"),c.filter({parentId:t.step,class:INPUT}).coerceTo("array").map(function(t){return{parameter:t("id"),parentId:e,value:t.hasFields("mapsTo").and(t("mapsTo").ne(null)).branch(s.filter({parentId:r,parameter:t("mapsTo")}).coerceTo("array").do(function(e){return e.count().gt(0).branch(e.nth(0)("value"),o("input").hasFields(t("name")).branch(o("input")(t("name")),t.hasFields("defaultValue").branch(t("defaultValue"),null)))}),o("input").hasFields(t("name")).branch(o("input")(t("name")),t.hasFields("defaultValue").branch(t("defaultValue"),null)))}}).do(function(e){return s.insert(e)}).do(function(){return i.insert({id:e,workflowRunThread:t.workflowRunThread,step:t.step,started:a.now(),status:CREATED},{returnChanges:n})}))})})})}function createStepRun(e){return function(t,r,n,o){var a=e.r,u=e.connection;return newStepRun(e,r,a.uuid())("changes").nth(0)("new_val").run(u)}}function startStepRun(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("StepRun");return r.started=a.now(),r.status=RUNNING,l.get(r.id).do(function(e){return e.eq(null).branch(a.error("StepRun not found"),e("status").ne(CREATED).branch(a.error("StepRun is not in a state that can be started"),l.get(r.id).update(_.omit(r,"id")).do(function(){return!0})))}).run(u)}}function endStepRun(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("StepRun");return r.ended=a.now(),l.get(r.id).eq(null).branch(a.error("StepRun not found"),l.get(r.id).update(_.omit(r,"id")).do(function(){return!0})).run(u)}}function createForks(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("WorkflowRun"),i=e.getTypeCollection("WorkflowRunThread"),s=e.getTypeCollection("Step");return l.get(r.workflowRun).do(function(e){return e.eq(null).branch(a.error("Workflow run does not exist"),e)}).do(function(){return s.get(r.step).do(function(t){return t.eq(null).branch(a.error("Step does not exist"),t("type").ne(FORK).branch(a.error("Step is not a FORK"),s.filter({fork:t("id")}).coerceTo("array").map(function(e){return{threadId:a.uuid(),stepRunId:a.uuid(),step:e("id")}}).do(function(t){return t.forEach(function(t){return newStepRun(e,{workflowRun:r.workflowRun,step:t("step"),workflowRunThread:t("threadId")},t("stepRunId"),!1,!1)}).do(function(){return i.get(r.workflowRunThread).do(function(e){return e.eq(null).branch(a.error("Parent thread does not exist"),i.get(r.workflowRunThread).update({status:FORKED}))})}).do(function(){return t.map(function(e){return{id:e("threadId"),workflowRun:r.workflowRun,currentStepRun:e("stepRunId"),status:CREATED,parentThread:r.workflowRunThread}}).coerceTo("array").do(function(e){return i.insert(e,{returnChanges:!0})("changes")("new_val")})})})))})}).run(u)}}function getJoinThreads(e){return function(t,r,n,o){var a=(e.r,e.connection),u=e.getTypeCollection("WorkflowRunThread"),l=e.getTypeCollection("Step"),i=e.getTypeCollection("StepRun");return l.filter({join:r.step})("id").coerceTo("array").do(function(e){return u.filter({workflowRun:r.workflowRun}).merge(function(e){return{step:i.get(e("currentStepRun")).do(function(e){return l.get(e("step"))("id")})}}).filter(function(t){return e.contains(t("step"))}).coerceTo("array")}).run(a)}}function createTask(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("Task"),i=this.globals._temporal.createTemporalTask;return r.entityType="TASK",l.filter(function(e){return e("name").match("(?i)^"+r.name+"$")}).count().ne(0).branch(a.error("A task with the name "+r.name+" already exists"),i(r)("changes").nth(0)("new_val")).run(u)}}function readTask(e){return function(t,r){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],o=(arguments[3],e.r),a=e.connection,u=this.globals._temporal,l=u.filterTemporalTask,i=u.mostCurrentTemporalTask;n.date=r.date||n.date;var s=o.expr(null);if(t)t.task&&(s=l({recordId:t.task,date:n.date}).coerceTo("array").do(function(e){return e.count().eq(0).branch(null,e.nth(0))}));else{if(!_.keys(r).length)return i().run(a);s=l(r)}return s.run(a)}}function updateTask(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("Task");return isPublished(e,"Task",r.id).branch(a.error("This task is published and cannot be modified"),l.get(r.id).update(_.omit(r,"id")).do(function(){return l.get(r.id)})).run(u)}}function deleteTask(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("Task"),i=e.getTypeCollection("Parameter"),s=e.getTypeCollection("Step");return isPublished(e,"Task",r.id).branch(a.error("This task is published and cannot be deleted"),s.filter(function(e){return e("task").eq(r.id).and(e("_temporal")("version").ne(null))}).count().ne(0).branch(a.error("This task belongs to a published step and cannot be deleted"),l.get(r.id).delete().do(function(){return i.filter({parentId:r.id}).delete().do(function(){return!0})}))).run(u)}}function getFullWorkflow(e,t){var r=e.r,n=(e.connection,e.getTypeCollection("Workflow")),o=e.getTypeCollection("Parameter"),a=e.getTypeCollection("Step");return n.get(t.id).eq(null).branch(r.error("Invalid workflow version"),n.get(t.id).merge(function(e){return{parameters:o.filter({parentId:t.id}).coerceTo("array"),steps:a.filter({workflowId:e("id")}).coerceTo("array").merge(function(e){return{parameters:o.filter({parentId:e("id")}).coerceTo("array")}})}}))}function getNewUuids(e,t,r){var n="fork"===e?["FORKID"]:[];return n.push(r.id),_.forEach(r.parameters,function(e){return n.push(e.id)}),_.forEach(r.steps,function(e){n.push(e.id),_.forEach(e.parameters,function(e){return n.push(e.id)})}),t.expr(n).map(function(e){return{orig:e,cur:t.uuid()}})}function remapObjects(e,t){var r=[],n=[],o=_.merge({},_.omit(e,["steps","parameters"]));return t.FORKID&&(o._temporal.recordId=t.FORKID),o._temporal.version=null,o._temporal.validFrom=null,o._temporal.validTo=null,o._temporal.changeLog=_.isArray(e._temporal.changeLog)?e._temporal.changeLog:[],o.id=t[e.id],_.forEach(e.parameters,function(e){n.push(_.merge({},e,{id:t[e.id],parentId:t[e.parentId]}))}),_.forEach(e.steps,function(e){var o=_.merge({},e);o._temporal.version=null,o._temporal.validFrom=null,o._temporal.validTo=null,o.id=_.get(t,e.id,null),o.workflowId=_.get(t,e.workflowId,null),o.success=_.get(t,e.success,null),o.fork=_.get(t,e.fork,null),o.fail=_.get(t,e.fail,null),r.push(o),_.forEach(e.parameters,function(e){n.push(_.merge({},e,{id:t[e.id],parentId:t[e.parentId]}))})}),{newWorkflow:o,newParams:n,newSteps:r}}function cloneWorkflow(e,t,r){var n=t.r,o=t.connection,a=t.getTypeCollection("Workflow"),u=t.getTypeCollection("Parameter"),l=t.getTypeCollection("Step"),i={};return getFullWorkflow(t,r).run(o).then(function(t){return getNewUuids(e,n,t).run(o).then(function(s){_.forEach(s,function(e){return i[e.orig]=e.cur});var c=remapObjects(t,i),d=c.newWorkflow,p=c.newSteps,f=c.newParams;return d._temporal.name=r.name||d.id,d._temporal.changeLog.push(_.merge(r.changeLog||{user:"SYSTEM",message:e},{date:n.now(),type:"branch"===e?"BRANCH":"FORK"})),n.expr([u.insert(f),l.insert(p)]).do(function(){return a.insert(d,{returnChanges:!0})("changes").nth(0)("new_val")}).run(o)})})}function branchWorkflow(e){return function(t,r,n,o){return cloneWorkflow("branch",e,r)}}function forkWorkflow(e){return function(t,r,n,o){return cloneWorkflow("fork",e,r)}}function publishWorkflow(e){return function(t,r,n,o){var a=(e.r,e.connection),u=e.getTypeCollection("Step"),l=e.getTypeComputed("Workflow").collection,i=this.globals._temporal.extendPublish;return i(l,r).then(function(e){var t=e._temporal,r=t.version,n=t.validFrom,o=t.validTo,l=e.id;return u.filter({workflowId:l}).update({_temporal:{version:r,validFrom:n,validTo:o}}).run(a).then(function(){return e})})}}function readWorkflowInputs(e){return function(t,r){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],o=(arguments[3],e.r),a=e.connection,u=this.globals._temporal,l=u.filterTemporalWorkflow,i=u.filterTemporalTask,s=e.getTypeCollection("Parameter"),c=e.getTypeCollection("Step");return n=_.omit(n,["recordId","id"]),c.filter({workflowId:t.id}).map(function(e){return o.expr([WORKFLOW$1,TASK$1]).contains(e("type")).branch(e.hasFields("versionArgs").branch(e("versionArgs").keys().count().ne(0).branch(e("versionArgs"),o.expr(n)),o.expr(n)).do(function(t){return o.branch(e("type").eq(WORKFLOW$1).and(e.hasFields("subWorkflow")),l(t.merge({recordId:e("subWorkflow")})),e("type").eq(TASK$1).and(e.hasFields("task")),i(t.merge({recordId:e("task")})),o.error("Temporal relation missing reference")).coerceTo("array").do(function(e){return e.count().eq(0).branch(null,e.nth(0)("id"))})}),e("id")).do(function(e){return s.filter({parentId:e,class:INPUT$1}).filter(function(e){return e.hasFields("mapsTo").not().or(e("mapsTo").eq(null))}).coerceTo("array")})}).reduce(function(e,t){return e.union(t)}).run(a)}}function createWorkflow(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=this.globals._temporal,i=l.createTemporalWorkflow,s=l.createTemporalStep;return a.do(a.uuid(),a.uuid(),a.uuid(),function(e,t,n){return r.id=e,r.entityType="WORKFLOW",r.endStep=n,s([{id:t,entityType:"STEP",name:"Start",description:"Starting point of the workflow",type:"START",timeout:0,failsWorkflow:!1,waitOnSuccess:!1,requireResumeKey:!1,success:n,fail:n,workflowId:e},{id:n,entityType:"STEP",name:"End",description:"Ending point of the workflow",type:"END",timeout:0,failsWorkflow:!1,waitOnSuccess:!1,requireResumeKey:!1,success:n,fail:n,workflowId:e}]).do(function(){return i(r)("changes").nth(0)("new_val")})}).run(u)}}function readWorkflow(e){return function(t,r){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],o=(arguments[3],e.r,e.connection),a=e.getTypeCollection("Workflow"),u=this.globals._temporal,l=u.filterTemporalWorkflow,i=u.mostCurrentTemporalWorkflow;return t&&t.workflow?a.get(t.workflow).run(o):(n.date=r.date||n.date,_.keys(r).length?l(r).run(o):i().run(o))}}function readWorkflowVersions(e){return function(t,r){var n=(arguments.length<=2||void 0===arguments[2]?{}:arguments[2],arguments[3],e.r,e.connection),o=e.getTypeCollection("Workflow"),a=o.filter({_temporal:{recordId:r.recordId}});return r.offset&&(a=a.skip(r.offset)),r.limit&&(a=a.limit(r.limit)),a.run(n)}}function updateWorkflow(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("Workflow");return isPublished(e,"Workflow",r.id).branch(a.error("This workflow is published and cannot be modified"),l.get(r.id).update(_.omit(r,"id")).do(function(){return l.get(r.id)})).run(u)}}function deleteWorkflow(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("Workflow"),i=e.getTypeCollection("Parameter"),s=e.getTypeCollection("Step");return isPublished(e,"Workflow",r.id).branch(a.error("This workflow is published and cannot be deleted"),s.filter({workflowId:r.id}).map(function(e){return e("id")}).coerceTo("array").do(function(t){return destroyStep(e,t)}).do(function(){return i.filter({parentId:r.id}).delete()}).do(function(){return l.get(r.id).delete().do(function(){return!0})})).run(u)}}function expandGQLErrors(e){if(_.isArray(e))return _.map(e,function(e){try{return _.isObject(e)?JSON.stringify(e):e}catch(t){return e}});try{return _.isObject(e)?JSON.stringify(e):e}catch(t){return e}}function gqlResult(e,t,r){var n=e.graphql.GraphQLError;return t.errors?r(new n(expandGQLErrors(t.errors))):r(null,t.data)}function convertType(e,t,r){if(!e||!t)throw new Error("could not determine type of variable name to convert");switch(e){case"ARRAY":if(_.isString(r))try{r=JSON.parse(r)}catch(e){}if(_.isArray(r))return r;case"BOOLEAN":var n=["true","TRUE","false","FALSE",0,1,"0","1"];if(_.isBoolean(r)||_.includes(n,r))return Boolean(r);case"DATE":try{return new Date(r)}catch(e){}case"NUMBER":if(_.isNumber(r))return Number(r);case"OBJECT":if(_.isString(r))try{r=JSON.parse(r)}catch(e){}if(_.isObject(r))return r;case"STRING":if(_.isString(r))return String(r);default:throw new Error(t+" could not be cast to type "+e)}}function mapInput(e,t,r){var n={};return _.forEach(r,function(r){if(r.class===OUTPUT)n[r.name]=null;else if(r.class===INPUT$2)if(r.mapsTo){var o=_.find(t,function(e){return _.get(e,"parameter.id")===r.mapsTo})||{},a=o.parameter,u=o.value;a&&(n[r.name]=u)}else try{n[r.name]=convertType(r.type,r.name,_.get(e,r.name))}catch(e){}}),n}function winTieBreak(e,t){return!_.without(t,e).length||t.sort()[0]===e}function createWorkflowRun(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("WorkflowRun"),i=e.getTypeCollection("ParameterRun"),s=e.getTypeCollection("StepRun"),c=e.getTypeCollection("WorkflowRunThread");return a.do(a.now(),a.uuid(),a.uuid(),a.uuid(),function(e,t,n,o){return l.insert({id:t,workflow:r.workflow,args:r.args,input:r.input,started:e,status:"RUNNING"},{returnChanges:!0})("changes").nth(0)("new_val").do(function(e){return c.insert({id:o,workflowRun:t,currentStepRun:n,status:"CREATED"}).do(function(){return r.parameters&&r.parameters.length?i.insert(_.map(r.parameters,function(e){return{parameter:e.id,parentId:t,class:e.class,value:_.get(e,"defaultValue")}})):null}).do(function(){return s.insert({id:n,workflowRunThread:o,step:r.step.id,status:"CREATED"})}).do(function(){if(!r.step.parameters.length)return null;var e=[];return _.forEach(r.step.parameters,function(t){var o=null;if(t.mapsTo)o=_.get(_.find(r.parameters,{id:t.mapsTo}),"defaultValue");else if(!t.mapsTo&&_.has(r.input,t.name))try{o=convertType(t.type,t.name,_.get(r.input,t.name))}catch(e){}e.push({parameter:t.id,parentId:n,class:t.class,value:o})}),i.insert(e)}).do(function(){return e})})}).run(u)}}function updateWorkflowRun(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("WorkflowRun");return l.get(r.id).eq(null).branch(a.error("WorkflowRun not found"),l.get(r.id).update(_.omit(r,"id")).do(function(){return l.get(r.id)})).run(u)}}function deleteWorkflowRun(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("WorkflowRun");return l.get(r.id).eq(null).branch(a.error("WorkflowRun not found"),l.get(r.id).delete().do(function(){return!0})).run(u)}}function endWorkflowRun(e){return function(t,r,n,o){var a=e.r,u=e.connection,l=e.getTypeCollection("WorkflowRun");return r.ended=a.now(),l.get(r.id).eq(null).branch(a.error("WorkflowRun not found"),l.get(r.id).update(_.omit(r,"id")).do(function(){return!0})).run(u)}}function computeWorkflowStatus(e,t){var r=this,n=(e.runner,e.workflowRun),o=e.thread,a=(e.endStep,e.localCtx,e.context,e.args,e.step);e.stepRunId,a.async,a.source,a.timeout,a.failsWorkflow,a.waitOnSuccess,a.success,a.fail,a.parameters;return this.log.trace({workflowRun:n},"attempting to complete workflow run computation"),this.lib.S2FWorkflow('{\n    readWorkflowRun (id: "'+n+'") {\n      threads {\n        stepRuns {\n          step { type, failsWorkflow }\n          status\n        }\n      }\n    }\n  }').then(function(e){return gqlResult(r,e,function(e,a){if(e)throw e;var u=_.get(a,"readWorkflowRun[0].threads");if(!u)throw new Error("No threads found");var l=_.reduce(u,function(e,t){return _.union(e,_.get(t,"stepRuns",[]))},[]),i=_.reduce(l,function(e,t){var r=_.includes([BASIC$1,TASK$3,WORKFLOW$3],t.type),n=!(t.failsWorkflow&&r&&t.status!==FAIL);return e&&n},!0);return r.lib.S2FWorkflow('mutation Mutation {\n        updateWorkflowRunThread (id: "'+o+'", status: '+JOINED$1+")\n        { id }\n      }").then(function(e){return gqlResult(r,e,function(e,o){if(e)throw e;return r.log.trace({workflowRun:n},"joined final thread"),r.lib.S2FWorkflow('mutation Mutation {\n            endWorkflowRun (id: "'+n+'", status: '+(i?SUCCESS:FAIL)+")\n          }").then(function(e){return gqlResult(r,e,function(e,o){if(e)throw e;return r.log.debug({workflowRun:n,success:i},"workflow run completed"),t()})})})})})}).catch(function(e){r.log.error({error:e},"failed to compute workflow"),t(e)})}function joinThreads(e,t){e.workflowRun,e.thread;t()}function nextStepRun(e,t){var r=this,n=e.thread,o=e.nextStep,a=e.async,u=e.workflowRun,l=_.get(this,"server._emitter");return l||a?this.lib.S2FWorkflow('{ readStep (id: "'+o+'") { type } }').then(function(i){return gqlResult(r,i,function(i,s){if(i)throw console.log(chalk.red(i)),i;var c=_.get(s,"readStep[0].type");if(!c)throw new Error("failed to get next step type");return c===JOIN$1?joinThreads.call(r,e,t):r.lib.S2FWorkflow('mutation Mutation {\n          createStepRun (step: "'+o+'", workflowRunThread: "'+n+'"),\n          { id }\n        }').then(function(e){return gqlResult(r,e,function(e,o){if(e)throw e;var i=_.get(o,"createStepRun.id");if(!i)throw new Error("Unable to create StepRun");return r.lib.S2FWorkflow('mutation Mutation {\n              updateWorkflowRunThread (id: "'+n+'", currentStepRun: "'+i+'", status: '+RUNNING$2+")\n              { id }\n            }").then(function(e){return gqlResult(r,e,function(e,r){if(e)throw e;return l.emit("schedule",{payload:{action:"runStep",context:{thread:n,workflowRun:u}}}),!!a||t()})})})})})}):t(new Error("No event emitter"))}function setStepStatus(e,t){var r=this;return this.lib.S2FWorkflow('mutation Mutation { endStepRun (id: "'+e+'", status: '+t+") }").then(function(e){return gqlResult(r,e,function(e,t){if(e)throw e;return t})})}function endWorkflow(e,t){var r=this,n=e.workflowRun,o=e.thread;return this.lib.S2FWorkflow('mutation Mutation {\n    updateWorkflowRunThread (id: "'+o+'", status: '+ENDING$1+")\n    { id }\n  }").then(function(a){return gqlResult(r,a,function(a,u){if(a)throw a;return r.lib.S2FWorkflow('{ readWorkflowRun (id: "'+n+'") { threads { id, status } } }').then(function(n){return gqlResult(r,n,function(n,a){if(n)throw n;var u=[],l=[];return _.forEach(_.get(a,"readWorkflowRun[0].threads"),function(e){_.includes(RUNNING_STATES$1,e.status)?l.push(e.id):e.status===ENDING$1&&u.push(e.id)}),l.length||!winTieBreak(o,u)?r.lib.S2FWorkflow('mutation Mutation {\n              updateWorkflowRunThread (id: "'+o+'", status: '+JOINED$2+")\n              { id }\n            }").then(function(e){return gqlResult(r,e,function(e,r){if(e)throw e;return t()})}):computeWorkflowStatus.call(r,e,t)})})})}).catch(function(e){r.log.error({error:e,thread:o,workflowRun:n},"failed to end workflow or thread"),t(e)})}function handleContext(e,t){var r=this;return function(n){var o=r.factory.utils.toObjectString,a=(e.runner,e.workflowRun),u=e.thread,l=e.endStep,i=(e.localCtx,e.context),s=(e.args,e.step),c=e.stepRunId,d=s.async,p=(s.source,s.timeout,s.failsWorkflow,s.waitOnSuccess,s.success),f=s.fail,m=s.parameters;f=f||l;var y=n._exception||n._result===!1,w=y?f:p,S=y?FAIL$1:SUCCESS$1;switch(s.type){case CONDITION$1:S=SUCCESS$1;break;case LOOP$2:S=SUCCESS$1}var T=[];return _.forEach(m,function(e){if(e.class===OUTPUT$1&&_.has(n,e.name)&&_.has(e,"mapsTo"))try{var t=_.find(i,{parameter:{id:e.mapsTo,class:ATTRIBUTE$1}});if(!t)return;T.push({id:t.id,value:convertType(e.type,e.name,_.get(n,e.name))})}catch(e){r.log.warn({error:e},"type conversion failed so value will not be set")}}),r.lib.S2FWorkflow("mutation Mutation {\n      updateAttributeValues (values: "+o(T)+")\n    }").then(function(){return setStepStatus.call(r,c,S).then(function(){return w===l?endWorkflow.call(r,e,t):d?void t():nextStepRun.call(r,{thread:u,workflowRun:a,nextStep:w,async:d},t)})})}}function basicRun(e){var t=e.source,r=e.context,n=e.timeout,o=e.payload,a=e.done;return sbx.vm(t,_.merge({context:r,timeout:n},_.get(this.options,"vm",{}))).then(handleContext.call(this,o,a))}function loopRun(e){var t=this,r=arguments.length<=1||void 0===arguments[1]?0:arguments[1],n=e.source,o=e.context,a=e.timeout,u=e.payload,l=e.done;return o.loop=r,sbx.vm(n,_.merge({context:o,timeout:a},_.get(this.options,"vm",{}))).then(function(e){return e._result===!1||e._exception?handleContext.call(t,u,l)(e):loopRun.call(t,{source:n,context:e,timeout:a,payload:u,done:l},r++)})}function runSource(e,t){var r=this,n=e.thread,o=e.endStep,a=e.localCtx,u=e.step,l=e.workflowRun,i=u.async,s=u.source,c=u.timeout,d=u.success;return s?this.lib.S2FWorkflow('mutation Mutation {\n    updateWorkflowRunThread ( id: "'+n+'", status: '+RUNNING$1+" )\n    { id }\n  }").then(function(p){return gqlResult(r,p,function(p,f){if(p)throw p;var m={source:s,context:a,timeout:c,payload:e,done:t},y=u.type===LOOP$1?loopRun.call(r,m):basicRun.call(r,m);return i&&d!==o?nextStepRun.call(r,{thread:n,workflowRun:l,nextStep:d,async:i},t):y})}).catch(function(e){t(e)}):t(new Error("No source"))}function forkSteps(e,t){var r=this,n=e.workflowRun,o=e.thread,a=e.stepRunId,u=e.step.id,l=_.get(this,"server._emitter");return l?this.lib.S2FWorkflow('mutation Mutation {\n    createForks (step: "'+u+'", workflowRun: "'+n+'", workflowRunThread: "'+o+'")\n    { id }\n  }').then(function(e){return gqlResult(r,e,function(e,o){if(e)throw e;return setStepStatus.call(r,a,FORKED$1).then(function(){return _.forEach(_.get(o,"createForks"),function(e){var t=e.id;l.emit("schedule",{payload:{action:"runStep",context:{thread:t,workflowRun:n}}})}),t()})})}).catch(function(e){r.log.error({errors:e.message||e,stack:e.stack},"Failed fork step"),t(e)}):t(new Error("No event emitter"))}function runStep(e){return function(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments[2],o=r.workflowRun,a=r.thread;return o&&a?e.lib.S2FWorkflow('{\n      readWorkflowRun (id: "'+o+'") {\n        workflow { endStep },\n        args,\n        input,\n        context {\n          id,\n          parameter { id, name, type, scope, class },\n          value\n        },\n        threads (id: "'+a+'") {\n          currentStepRun {\n            id,\n            step {\n              id,\n              type,\n              async,\n              source,\n              subWorkflow,\n              timeout,\n              failsWorkflow,\n              waitOnSuccess,\n              requireResumeKey,\n              success,\n              fail,\n              parameters { id, name, type, scope, class, mapsTo }\n            }\n          }\n        }\n      }\n    }').then(function(r){return gqlResult(e,r,function(r,u){if(r)throw r;var l=_.get(u,"readWorkflowRun[0]",{}),i=l.workflow.endStep,s=l.args,c=l.input,d=l.context,p=l.threads,f=_.get(p,"[0].currentStepRun.step"),m=_.get(p,"[0].currentStepRun.id");if(!f)return n(new Error("No step found in thread"));e.log.trace({step:f.id},"Successfully queried step");var y=mapInput(c,d,_.get(f,"parameters",[]));return e.lib.S2FWorkflow('mutation Mutation { startStepRun (id: "'+m+'") }').then(function(r){var u={runner:t,workflowRun:o,thread:a,endStep:i,localCtx:y,context:d,args:s,step:f,stepRunId:m};switch(f.type){case START:case END:case BASIC:return runSource.call(e,u,n);case TASK$2:return runSource.call(e,u,n);case LOOP:return runSource.call(e,u,n);case CONDITION:return runSource.call(e,u,n);
case JOIN:return joinThreads.call(e,u,n);case WORKFLOW$2:case FORK$1:return forkSteps.call(e,u,n);default:return n(new Error("Invalid step type or action cannot be performed on type"))}})})}).catch(function(t){return e.log.error({errors:t.message||t,stack:t.stack},"Failed to start step"),n(t)}):n(new Error("No workflow run or main thread created"))}}function createWorkflowRun$1(e,t,r,n){var o=this,a=t.args,u=t.input,l=n.steps[0];l.type=Enum(l.type),_.forEach(l.parameters,function(e){e.class=Enum(e.class),e.type=Enum(e.type)}),_.forEach(n.parameters,function(e){e.class=Enum(e.class),e.type=Enum(e.type)});var i={workflow:n.id,args:a,input:u,parameters:n.parameters,step:l};return this.lib.S2FWorkflow("mutation Mutation {\n    createWorkflowRun ("+toObjectString$1(i,{noOuterBraces:!0})+") {\n      id,\n      threads { id }\n    }\n  }").then(function(t){return gqlResult(o,t,function(t,n){if(t)throw t;var a=_.get(n,"createWorkflowRun.id"),u=_.get(n,"createWorkflowRun.threads[0].id");return runStep(o)(e,{workflowRun:a,thread:u},r)})}).catch(function(e){return r(e)})}function startWorkflow(e){return function(t){var r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments[2],o=r.args,a=r.input;return a=a||{},o?e.lib.S2FWorkflow("{\n      readWorkflow ("+toObjectString(o,{noOuterBraces:!0})+") {\n        _temporal { recordId },\n        id,\n        name,\n        inputs { id, name, type, class, required, defaultValue },\n        parameters { id, name, class, type, required, defaultValue },\n        steps (first: true) {\n          id,\n          name,\n          type,\n          async,\n          source,\n          subWorkflow,\n          timeout,\n          failsWorkflow,\n          waitOnSuccess,\n          requireResumeKey,\n          success,\n          fail,\n          parameters { id, name, type, class, required, mapsTo, defaultValue }\n        }\n      }\n    }",{},o).then(function(r){return gqlResult(e,r,function(r,u){var l=_.get(u,"readWorkflow[0]"),i=_.get(l,"steps[0]");if(r)throw r;if(!l)throw new Error("No workflow found");if(!i||"END"===i.type)throw new Error("The workflow contains no valid steps");e.log.trace({server:e._server,workflow:l.id},"Successfully queried workflow");var s=!0,c=!1,d=void 0;try{for(var p,f=l.inputs[Symbol.iterator]();!(s=(p=f.next()).done);s=!0){var m=p.value;if(m.required&&!_.has(a,m.name))throw new Error("missing required input "+m.name);_.has(a,m.name)&&(a[m.name]=convertType(m.type,m.name,a[m.name]))}}catch(e){c=!0,d=e}finally{try{!s&&f.return&&f.return()}finally{if(c)throw d}}return createWorkflowRun$1.call(e,t,{args:o,input:a},n,l)})}).catch(function(t){return console.log(t),e.log.error({errors:t.message||t,stack:t.stack},"Failed to start workflow"),n(t)}):n(new Error("No context was supplied"))}}function actions(e){return{startWorkflow:startWorkflow(e),runStep:runStep(e)}}function rethinkdb$1(e,t,r,n,o){return new S2fRethinkDBBackend(e,t,r,n,o)}Object.defineProperty(exports,"__esModule",{value:!0});var _=_interopDefault(require("lodash")),chalk=_interopDefault(require("chalk")),yellowjacket=require("yellowjacket"),FactoryTemporalPlugin=_interopDefault(require("graphql-factory-temporal")),graphqlFactoryTemporal_backend=require("graphql-factory-temporal/backend"),graphql_error=require("graphql/error"),factory=_interopDefault(require("graphql-factory")),sbx=_interopDefault(require("sbx")),S2FDescribed={description:{type:"String"}},S2FEntity={id:{type:"String",primary:!0},entityType:{type:"EntityTypeEnum"}},S2FNamed={name:{type:"String"}},fields={S2FDescribed:S2FDescribed,S2FEntity:S2FEntity,S2FNamed:S2FNamed},EntityTypeEnum={type:"Enum",values:{PARAMETER:"PARAMETER",PARAMETERRUN:"PARAMETERRUN",STEP:"STEP",STEPRUN:"STEPRUN",TASK:"TASK",WORKFLOW:"WORKFLOW",WORKFLOWRUN:"WORKFLOWRUN",RUNQUEUE:"RUNQUEUE"}},Parameter={type:["Object","Input"],fields:{id:{type:"String",primary:!0},entityType:{type:"EntityTypeEnum"},name:{type:"String"},description:{type:"String"},type:{description:"The data type of the parameter",type:"ParameterTypeEnum",nullable:!1},scope:{description:"The scope of the parameter",type:"ParameterScopeEnum",nullable:!1,omitFrom:"Input"},class:{description:"Class of parameter",type:"ParameterClassEnum"},required:{description:"Parameter is required",type:"Boolean",nullable:!1},mapsTo:{description:"Name of global context parameter to map",type:"String"},defaultValue:{description:"Default value",type:"String"},parentId:{description:"Object the parameter belongs to",type:"String",belongsTo:{Workflow:{parameters:"id"},Step:{parameters:"id"},Task:{parameters:"id"}}}},_backend:{schema:"S2FWorkflow",collection:"parameter",mutation:{create:{resolve:"createParameter"},update:{resolve:"updateParameter"},delete:{resolve:"deleteParameter"}}}},ParameterClassEnum={type:"Enum",values:{ATTRIBUTE:"ATTRIBUTE",INPUT:"INPUT",OUTPUT:"OUTPUT"}},ParameterRun={fields:{id:{type:"String",primary:!0},entityType:{type:"EntityTypeEnum"},parameter:{type:"Parameter",has:"id"},parentId:{type:"String",belongsTo:{WorkflowRun:{context:"id"},StepRun:{context:"id"}}},value:{type:"FactoryJSON"}},_backend:{schema:"S2FWorkflow",collection:"parameter_run",mutation:{create:{type:"ParameterRun",args:{parameter:{type:"String",nullable:!1},parentId:{type:"String",nullable:!1},value:{type:"FactoryJSON"}},resolve:"createParameterRun"},update:{type:"ParameterRun",args:{id:{type:"String",nullable:!1},value:{type:"FactoryJSON"}},resolve:"updateParameterRun"},delete:{args:{id:{type:"String",nullable:!1}},resolve:"deleteParameterRun"},updateAttributeValues:{type:"Boolean",args:{values:{type:["ParameterRunValueInput"],nullable:!1}},resolve:"updateAttributeValues"}}}},ParameterRunValueInput={type:"Input",fields:{id:{type:"String"},value:{type:"FactoryJSON"}}},ParameterTypeEnum={type:"Enum",values:{ARRAY:"ARRAY",BOOLEAN:"BOOLEAN",DATE:"DATE",NUMBER:"NUMBER",OBJECT:"OBJECT",STRING:"STRING",PASSWORD:"PASSWORD"}},ParameterScopeEnum={type:"Enum",values:{WORKFLOW:"WORKFLOW",STEP:"STEP",TASK:"TASK"}},RunStatusEnum={type:"Enum",values:{CREATED:"CREATED",RUNNING:"RUNNING",WAITING:"WAITING",JOINING:"JOINING",FORKING:"FORKING",SUCCESS:"SUCCESS",FAIL:"FAIL",FORKED:"FORKED",JOINED:"JOINED",ENDING:"ENDING",ENDED:"ENDED"}},Step={extendFields:["TemporalType"],fields:{id:{type:"String",primary:!0},entityType:{type:"EntityTypeEnum"},name:{type:"String"},description:{type:"String"},workflowId:{description:"Workflow the step belongs to",type:"String",nullable:!1,belongsTo:{Workflow:{steps:"id"}}},type:{description:"Step type (condition, loop, fork, join, workflow, task, etc...)",type:"StepTypeEnum",nullable:!1},async:{description:"Step runs asynchronously",type:"Boolean"},source:{description:"Source code to run. Can be null if a task or subworkflow is being used",type:"String",resolve:"readSource"},task:{description:"Published task to use as source for execution code",type:"Task",has:"id",resolve:"readTask"},subWorkflow:{description:"Nested workflow to run",type:"String"},versionArgs:{description:"Lock a task or subworkflow into a specific version",type:"FactoryJSON"},timeout:{description:"Time in ms to allow the step to run before timing out",type:"Int",nullable:!1},failsWorkflow:{description:"If true and this step fails, the workflow will be considered failed",type:"Boolean",nullable:!1},waitOnSuccess:{description:"On successful step completion wait for external input to resume",type:"Boolean",nullable:!1},requireResumeKey:{description:"Used with waitOnSuccess. The StepRun key is required to initiate a workflow resume",type:"Boolean",nullable:!1},success:{description:"Step to execute on success",type:"String"},fail:{description:"Step to execute on failure, defaults to end",type:"String"},parameters:{description:"Local parameters associated with the step",type:["Parameter"],resolve:"readStepParams"},fork:{type:"String",belongsTo:{Step:{threads:"id"}}},threads:{description:"Keeps track of the forked threads for a fork or the threads that will join if a join",type:["Step"],resolve:"readStepThreads"},ex:{description:"Extension data, can be used by plugins for example ui positioning information",type:"FactoryJSON"}},_backend:{schema:"S2FWorkflow",collection:"step",temporal:!0,query:{read:{resolve:"readStep"}},mutation:{create:{type:"Step",args:{workflowId:{type:"String",nullable:!1},name:{type:"String",nullable:!1},type:{type:"StepTypeEnum",nullable:!1},async:{type:"Boolean",defaultValue:!1},source:{type:"String"},task:{type:"String"},subWorkflow:{type:"String"},timeout:{type:"Int",defaultValue:0},failsWorkflow:{type:"Boolean",defaultValue:!1},waitOnSuccess:{type:"Boolean",defaultValue:!1},requireResumeKey:{type:"Boolean",defaultValue:!1},success:{type:"String"},fail:{type:"String"}},resolve:"createStep"},update:{type:"Step",args:{id:{type:"String",nullable:!1},name:{type:"String"},async:{type:"Boolean"},source:{type:"String"},task:{type:"String"},subWorkflow:{type:"String"},timeout:{type:"Int"},failsWorkflow:{type:"Boolean"},waitOnSuccess:{type:"Boolean"},requireResumeKey:{type:"Boolean"},success:{type:"String"},fail:{type:"String"}},resolve:"updateStep"},delete:{type:"Boolean",args:{id:{type:"String",nullable:!1}},resolve:"deleteStep"}}}},StepInput={type:"Input",fields:{id:{type:"String",primary:!0},entityType:{type:"EntityTypeEnum"},name:{type:"String"},description:{type:"String"},type:{description:"Step type (condition, loop, fork, join, workflow, task, etc...)",type:"StepTypeEnum",nullable:!1},async:{description:"Step runs asynchronously",type:"Boolean"},source:{description:"Source code to run. Can be null if a task or subworkflow is being used",type:"String"},subWorkflow:{description:"Nested workflow to run",type:"String"},timeout:{description:"Time in ms to allow the step to run before timing out",type:"Int",nullable:!1},failsWorkflow:{description:"If true and this step fails, the workflow will be considered failed",type:"Boolean",nullable:!1},waitOnSuccess:{description:"On successful step completion wait for external input to resume",type:"Boolean",nullable:!1},requireResumeKey:{description:"Used with waitOnSuccess. The StepRun key is required to initiate a workflow resume",type:"Boolean",nullable:!1},success:{description:"Step to execute on success",type:"String"},fail:{description:"Step to execute on failure, defaults to end",type:"String"},parameters:{type:["ParameterInput"]}}},StepRun={fields:{id:{type:"String",primary:!0},entityType:{type:"EntityTypeEnum"},workflowRunThread:{type:"String",belongsTo:{WorkflowRunThread:{stepRuns:"id"}}},context:{type:["ParameterRun"]},step:{description:"The step associated with this run",type:"Step",has:"id"},started:{type:"FactoryDateTime"},ended:{type:"FactoryDateTime"},status:{type:"RunStatusEnum"}},_backend:{schema:"S2FWorkflow",collection:"step_run",mutation:{create:{type:"StepRun",args:{step:{type:"String",nullable:!1},workflowRunThread:{type:"String",nullable:!1}},resolve:"createStepRun"},update:{type:"StepRun",args:{id:{type:"String",nullable:!1},status:{type:"RunStatusEnum"},ended:{type:"FactoryDateTime"}},resolve:"updateStepRun"},delete:{type:"Boolean",args:{id:{type:"String",nullable:!1}},resolve:"deleteStepRun"},startStepRun:{type:"Boolean",args:{id:{type:"String",nullable:!1}},resolve:"startStepRun"},endStepRun:{type:"Boolean",args:{id:{type:"String",nullable:!1},status:{type:"RunStatusEnum",nullable:!1}},resolve:"endStepRun"},createForks:{type:["WorkflowRunThread"],args:{step:{type:"String",nullable:!1},workflowRun:{type:"String",nullable:!1},workflowRunThread:{type:"String",nullable:!1}},resolve:"createForks"},getJoinThreads:{type:["WorkflowRunThread"],args:{step:{type:"String",nullable:!1},workflowRun:{type:"String",nullable:!1}},resolve:"getJoinThreads"}}}},StepTypeEnum={type:"Enum",values:{BASIC:"BASIC",CONDITION:"CONDITION",END:"END",FORK:"FORK",JOIN:"JOIN",LOOP:"LOOP",START:"START",TASK:"TASK",WORKFLOW:"WORKFLOW"}},Task={extendFields:["TemporalType"],fields:{id:{type:"String",primary:!0},entityType:{type:"EntityTypeEnum"},name:{type:"String"},description:{type:"String"},source:{type:"String",nullable:!1},parameters:{type:["Parameter"]}},_backend:{schema:"S2FWorkflow",collection:"task",temporal:!0,query:{read:{type:["Task"],args:{recordId:{type:"String"},id:{type:"String"},version:{type:"String"},date:{type:"FactoryDateTime"}},resolve:"readTask"}},mutation:{create:{type:"Task",args:{name:{type:"String",nullable:!1},description:{type:"String"},source:{type:"String",nullable:!1}},resolve:"createTask"},update:{type:"Task",args:{id:{type:"String",nullable:!1},name:{type:"String"},description:{type:"String"},source:{type:"String"}},resolve:"updateTask"},delete:{type:"Boolean",args:{id:{type:"String",nullable:!1}},resolve:"deleteTask"}}}},Workflow={extendFields:["TemporalType"],fields:{id:{type:"String",primary:!0},entityType:{type:"EntityTypeEnum"},name:{type:"String"},description:{type:"String"},inputs:{description:"Inputs from steps",type:["Parameter"],args:{id:{type:"String"}},resolve:"readWorkflowInputs"},parameters:{description:"Global parameters",type:["Parameter"]},steps:{description:"Steps in the workflow",type:["Step"],args:{id:{type:"String"},first:{type:"Boolean"}},resolve:"readStep"},endStep:{type:"String"}},_backend:{schema:"S2FWorkflow",collection:"workflow",temporal:!0,query:{read:{type:["Workflow"],args:{recordId:{type:"String"},id:{type:"String"},version:{type:"String"},date:{type:"FactoryDateTime"}},resolve:"readWorkflow"},readWorkflowVersions:{type:["Workflow"],args:{recordId:{type:"String",nullable:!1},limit:{type:"Int"},offset:{type:"Int"}},resolve:"readWorkflowVersions"}},mutation:{create:{type:"Workflow",args:{name:{type:"String",nullable:!1},description:{type:"String"}},resolve:"createWorkflow"},update:{type:"Workflow",args:{name:{type:"String"},description:{type:"String"}},resolve:"updateWorkflow"},delete:{type:"Boolean",args:{id:{type:"String",nullable:!1}},resolve:"deleteWorkflow"},branchWorkflow:{type:"Workflow",args:{id:{type:"String",nullable:!1},name:{type:"String",nullable:!1},changeLog:{type:"TemporalChangeLogInput"}},resolve:"branchWorkflow"},forkWorkflow:{type:"Workflow",args:{id:{type:"String",nullable:!1},name:{type:"String",nullable:!1},changeLog:{type:"TemporalChangeLogInput"}},resolve:"forkWorkflow"},publishWorkflow:{type:"Workflow",args:{id:{type:"String",nullable:!1},version:{type:"String"},changeLog:{type:"TemporalChangeLogInput"}},resolve:"publishWorkflow"}}}},WorkflowRun={fields:{id:{type:"String",primary:!0},entityType:{type:"EntityTypeEnum"},workflow:{type:"Workflow",has:"id",resolve:"readWorkflow"},args:{type:"FactoryJSON"},input:{type:"FactoryJSON"},context:{type:["ParameterRun"],resolve:"readParameterRun"},threads:{type:["WorkflowRunThread"],resolve:"readWorkflowRunThread"},started:{type:"FactoryDateTime"},ended:{type:"FactoryDateTime"},status:{type:"RunStatusEnum"},parentStepRun:{type:"String"}},_backend:{schema:"S2FWorkflow",collection:"workflow_run",mutation:{create:{args:{workflow:{type:"String"},args:{type:"FactoryJSON"},input:{type:"FactoryJSON"},parameters:{type:["ParameterInput"]},step:{type:"StepInput"}},resolve:"createWorkflowRun"},update:{type:"WorkflowRun",args:{id:{type:"String",nullable:!1},status:{type:"RunStatusEnum"},ended:{type:"FactoryDateTime"}},resolve:"updateWorkflowRun"},delete:{type:"Boolean",args:{id:{type:"String",nullable:!1}},resolve:"deleteWorkflowRun"},endWorkflowRun:{type:"Boolean",args:{id:{type:"String",nullable:!1},status:{type:"RunStatusEnum",nullable:!1}},resolve:"endWorkflowRun"}}}},WorkflowRunThread={fields:{id:{type:"String",primary:!0},entityType:{type:"EntityTypeEnum"},parentThread:{type:"WorkflowRunThread",has:"id",resolve:"readWorkflowRunThread"},workflowRun:{type:"WorkflowRun",belongsTo:{WorkflowRun:{threads:"id"}}},currentStepRun:{type:"StepRun",has:"id",resolve:"readStepRun"},stepRuns:{type:["StepRun"],resolve:"readStepRun"},status:{type:"RunStatusEnum"}},_backend:{schema:"S2FWorkflow",collection:"workflow_run_thread",mutation:{create:{args:{workflowRun:{type:"String",nullable:!1},currentStepRun:{type:"String",nullable:!1}}},update:{args:{id:{type:"String",nullable:!1},currentStepRun:{type:"String"},status:{type:"RunStatusEnum"}}},delete:{args:{id:{type:"String",nullable:!1}}}}}},types={EntityTypeEnum:EntityTypeEnum,Parameter:Parameter,ParameterClassEnum:ParameterClassEnum,ParameterRun:ParameterRun,ParameterRunValueInput:ParameterRunValueInput,ParameterTypeEnum:ParameterTypeEnum,ParameterScopeEnum:ParameterScopeEnum,RunStatusEnum:RunStatusEnum,Step:Step,StepInput:StepInput,StepRun:StepRun,StepTypeEnum:StepTypeEnum,Task:Task,Workflow:Workflow,WorkflowRun:WorkflowRun,WorkflowRunThread:WorkflowRunThread},workflow={handler:function(e){var t=e.payload,r=e.socket,n=e.requestId,o=t.query,a=t.rootValue,u=t.contextValue,l=t.variableValues,i=t.operationName;return this.backend.lib.S2FWorkflow(o,a,u,l,i).then(function(e){return r.emit("result."+n,e)}).catch(function(e){return r.emit("result."+n,{errors:[e]})})}},local={workflow:workflow},workflow$1={handler:function(e){this._emitter.emit("workflow",e)}},socket={workflow:workflow$1},events={local:local,socket:socket},ATTRIBUTE=ParameterClassEnum.values.ATTRIBUTE,_StepTypeEnum$values=StepTypeEnum.values,WORKFLOW=_StepTypeEnum$values.WORKFLOW,TASK=_StepTypeEnum$values.TASK,INPUT=ParameterClassEnum.values.INPUT,_RunStatusEnum$values=RunStatusEnum.values,FORKED=_RunStatusEnum$values.FORKED,CREATED=_RunStatusEnum$values.CREATED,RUNNING=_RunStatusEnum$values.RUNNING,FORK=StepTypeEnum.values.FORK,_StepTypeEnum$values$1=StepTypeEnum.values,TASK$1=_StepTypeEnum$values$1.TASK,WORKFLOW$1=_StepTypeEnum$values$1.WORKFLOW,INPUT$1=ParameterClassEnum.values.INPUT,_ParameterClassEnum$v=ParameterClassEnum.values,INPUT$2=_ParameterClassEnum$v.INPUT,OUTPUT=_ParameterClassEnum$v.OUTPUT,functions={createParameter:createParameter,updateParameter:updateParameter,deleteParameter:deleteParameter,createParameterRun:createParameterRun,updateParameterRun:updateParameterRun,deleteParameterRun:deleteParameterRun,updateAttributeValues:updateAttributeValues,createStep:createStep,readStep:readStep,updateStep:updateStep,deleteStep:deleteStep,readStepThreads:readStepThreads,readSource:readSource,readStepParams:readStepParams,createStepRun:createStepRun,startStepRun:startStepRun,endStepRun:endStepRun,createForks:createForks,getJoinThreads:getJoinThreads,createTask:createTask,readTask:readTask,updateTask:updateTask,deleteTask:deleteTask,branchWorkflow:branchWorkflow,forkWorkflow:forkWorkflow,publishWorkflow:publishWorkflow,createWorkflow:createWorkflow,readWorkflow:readWorkflow,updateWorkflow:updateWorkflow,deleteWorkflow:deleteWorkflow,readWorkflowInputs:readWorkflowInputs,readWorkflowVersions:readWorkflowVersions,createWorkflowRun:createWorkflowRun,updateWorkflowRun:updateWorkflowRun,deleteWorkflowRun:deleteWorkflowRun,endWorkflowRun:endWorkflowRun},_StepTypeEnum$values$2=StepTypeEnum.values,BASIC$1=_StepTypeEnum$values$2.BASIC,TASK$3=_StepTypeEnum$values$2.TASK,WORKFLOW$3=_StepTypeEnum$values$2.WORKFLOW,_RunStatusEnum$values$2=RunStatusEnum.values,FAIL=_RunStatusEnum$values$2.FAIL,SUCCESS=_RunStatusEnum$values$2.SUCCESS,JOINED$1=_RunStatusEnum$values$2.JOINED,_RunStatusEnum$values$1=RunStatusEnum.values,CREATED$1=_RunStatusEnum$values$1.CREATED,FORKING=_RunStatusEnum$values$1.FORKING,JOINING=_RunStatusEnum$values$1.JOINING,ENDING=_RunStatusEnum$values$1.ENDING,RUNNING$3=_RunStatusEnum$values$1.RUNNING,JOINED=_RunStatusEnum$values$1.JOINED,RUNNING_STATES=[CREATED$1,FORKING,JOINING,RUNNING$3],RUNNING$2=RunStatusEnum.values.RUNNING,JOIN$1=StepTypeEnum.values.JOIN,_RunStatusEnum$values$4=RunStatusEnum.values,CREATED$2=_RunStatusEnum$values$4.CREATED,FORKING$1=_RunStatusEnum$values$4.FORKING,JOINING$1=_RunStatusEnum$values$4.JOINING,ENDING$1=_RunStatusEnum$values$4.ENDING,RUNNING$4=_RunStatusEnum$values$4.RUNNING,JOINED$2=_RunStatusEnum$values$4.JOINED,RUNNING_STATES$1=[CREATED$2,FORKING$1,JOINING$1,RUNNING$4],_RunStatusEnum$values$3=RunStatusEnum.values,SUCCESS$1=_RunStatusEnum$values$3.SUCCESS,FAIL$1=_RunStatusEnum$values$3.FAIL,_ParameterClassEnum$v$1=ParameterClassEnum.values,OUTPUT$1=_ParameterClassEnum$v$1.OUTPUT,ATTRIBUTE$1=_ParameterClassEnum$v$1.ATTRIBUTE,_StepTypeEnum$values$3=StepTypeEnum.values,CONDITION$1=_StepTypeEnum$values$3.CONDITION,LOOP$2=_StepTypeEnum$values$3.LOOP,RUNNING$1=RunStatusEnum.values.RUNNING,LOOP$1=StepTypeEnum.values.LOOP,FORKED$1=RunStatusEnum.values.FORKED,_StepTypes$values=StepTypeEnum.values,BASIC=_StepTypes$values.BASIC,CONDITION=_StepTypes$values.CONDITION,END=_StepTypes$values.END,FORK$1=_StepTypes$values.FORK,JOIN=_StepTypes$values.JOIN,LOOP=_StepTypes$values.LOOP,START=_StepTypes$values.START,TASK$2=_StepTypes$values.TASK,WORKFLOW$2=_StepTypes$values.WORKFLOW,_factory$utils=factory.utils,toObjectString$1=_factory$utils.toObjectString,Enum=_factory$utils.Enum,toObjectString=factory.utils.toObjectString,Task$2=[{_temporal:{changeLog:[{date:new Date(1473606625377),message:"Publish",type:"PUBLISH",user:"SYSTEM"}],recordId:"4c35b5a7-e971-4719-9846-ca06db2f8eb2",validFrom:new Date(1473606625377),validTo:null,version:"0.1.0"},entityType:"TASK",id:"0ea85a8a-ba97-4c31-8ed0-37926989b384",name:"Task1",source:'console.log("Hello", name)'},{_temporal:{recordId:"4c35b5a7-e971-4719-9846-ca06db2f8eb2",validFrom:null,validTo:null},entityType:"TASK",id:"b98548c6-d294-4406-88c1-3d7cffb97cfa",name:"Task1",source:'console.log("Hi", name)'}],Parameter$2=[{entityType:"PARAMETER",id:"0a329a80-3b97-4b83-832f-7f9c960afdfc",name:"name",parentId:"0ea85a8a-ba97-4c31-8ed0-37926989b384",required:"false",scope:"TASK",class:"INPUT",type:"STRING"},{entityType:"PARAMETER",id:"fed6aa1e-5a25-4cd6-8b35-20ad0e6547df",name:"name",parentId:"b98548c6-d294-4406-88c1-3d7cffb97cfa",required:"false",scope:"TASK",class:"INPUT",type:"STRING"}],SayHello={Task:Task$2,Parameter:Parameter$2},tasks=[SayHello],Workflow$2=[{_temporal:{changeLog:[],recordId:"72264666-5e7b-4bd7-b6f6-efff3a5aa73c",validFrom:null,validTo:null,version:null},entityType:"WORKFLOW",id:"170ab3d5-4ff4-41ed-b875-010067d1ebc5",name:"Fork Join Test",endStep:"44dad1a6-31d6-4d9b-9106-b80d05823195"}],Step$2=[{_temporal:{changeLog:[],recordId:"f32485c9-3087-43bc-9565-55a594fe9224",validFrom:null,validTo:null,version:null},description:"Ending point of the workflow",entityType:"STEP",fail:"44dad1a6-31d6-4d9b-9106-b80d05823195",failsWorkflow:!1,id:"44dad1a6-31d6-4d9b-9106-b80d05823195",name:"End",requireResumeKey:!1,success:"44dad1a6-31d6-4d9b-9106-b80d05823195",timeout:0,type:"END",waitOnSuccess:!1,workflowId:"170ab3d5-4ff4-41ed-b875-010067d1ebc5"},{_temporal:{changeLog:[],recordId:"f1b70a2c-e583-4fcb-abf0-ae01621678c5",validFrom:null,validTo:null,version:null},async:!1,entityType:"STEP",failsWorkflow:!1,id:"b6a0edaa-2417-4e75-8083-c62250dae391",name:"Fork",requireResumeKey:!1,timeout:0,type:"FORK",waitOnSuccess:!1,workflowId:"170ab3d5-4ff4-41ed-b875-010067d1ebc5"},{_temporal:{changeLog:[],recordId:"e432ac48-6f52-4776-8c20-842246fe54f9",validFrom:null,validTo:null,version:null},async:!0,entityType:"STEP",failsWorkflow:!1,id:"80c73966-aac8-4f7b-b889-e64363322b4b",name:"Fork Left",source:'console.log("===========");console.log("=========== Forking Left", name);console.log("===========")',requireResumeKey:!1,success:"453721c9-9347-4d22-a07f-b85630954835",timeout:0,type:"BASIC",waitOnSuccess:!1,fork:"b6a0edaa-2417-4e75-8083-c62250dae391",workflowId:"170ab3d5-4ff4-41ed-b875-010067d1ebc5"},{_temporal:{changeLog:[],recordId:"2108ead8-917f-43ef-ba2a-0d074bb300bd",validFrom:null,validTo:null,version:null},async:!1,entityType:"STEP",failsWorkflow:!1,id:"453721c9-9347-4d22-a07f-b85630954835",name:"After Fork Left",source:'console.log("===========");console.log("=========== After Fork Left");console.log("===========")',requireResumeKey:!1,success:"b97ca7ae-b5de-4204-8440-5b695dfe45f9",timeout:0,type:"BASIC",waitOnSuccess:!1,workflowId:"170ab3d5-4ff4-41ed-b875-010067d1ebc5"},{_temporal:{changeLog:[],recordId:"86393566-88b7-4971-97bf-6f60ea8df80c",validFrom:null,validTo:null,version:null},async:!1,entityType:"STEP",failsWorkflow:!1,id:"3e5d2306-d12d-48f9-a9ee-a4b53acc753b",name:"Fork Right",source:'console.log("===========");console.log("=========== Forking Right");console.log("===========")',requireResumeKey:!1,success:"b97ca7ae-b5de-4204-8440-5b695dfe45f9",timeout:0,type:"BASIC",waitOnSuccess:!1,fork:"b6a0edaa-2417-4e75-8083-c62250dae391",workflowId:"170ab3d5-4ff4-41ed-b875-010067d1ebc5"},{_temporal:{changeLog:[],recordId:"75c03bdd-ec3d-49ad-9ecb-207e9b511869",validFrom:null,validTo:null,version:null},async:!1,entityType:"STEP",failsWorkflow:!1,id:"b97ca7ae-b5de-4204-8440-5b695dfe45f9",name:"Join",requireResumeKey:!1,timeout:0,type:"JOIN",success:"44dad1a6-31d6-4d9b-9106-b80d05823195",waitOnSuccess:!1,workflowId:"170ab3d5-4ff4-41ed-b875-010067d1ebc5"},{_temporal:{changeLog:[],recordId:"7af16dd4-346a-4527-b9d4-b58d31017c4d",validFrom:null,validTo:null,version:null},description:"Starting point of the workflow",entityType:"STEP",fail:"44dad1a6-31d6-4d9b-9106-b80d05823195",failsWorkflow:!1,id:"1cb92ccb-e022-4b43-aa29-8e37492b021e",name:"Start",requireResumeKey:!1,success:"b6a0edaa-2417-4e75-8083-c62250dae391",timeout:0,type:"START",waitOnSuccess:!1,workflowId:"170ab3d5-4ff4-41ed-b875-010067d1ebc5"}],Parameter$3=[{entityType:"PARAMETER",id:"c9cf9ca4-4053-4c32-b052-ad79f262df27",name:"name",parentId:"80c73966-aac8-4f7b-b889-e64363322b4b",required:"false",scope:"STEP",class:"INPUT",type:"STRING"},{entityType:"PARAMETER",id:"4686b2eb-7815-4bad-a941-dcbd36f1fba7",name:"name",parentId:"80c73966-aac8-4f7b-b889-e64363322b4b",required:"false",scope:"STEP",mapsTo:"9bbf9716-f6eb-4dd5-a9c5-b44fb29f93d0",class:"OUTPUT",type:"STRING"},{entityType:"PARAMETER",id:"9bbf9716-f6eb-4dd5-a9c5-b44fb29f93d0",name:"message",defaultValue:"Hello",parentId:"170ab3d5-4ff4-41ed-b875-010067d1ebc5",required:"false",scope:"WORKFLOW",class:"ATTRIBUTE",type:"STRING"}],ForkJoinTest={Workflow:Workflow$2,Step:Step$2,Parameter:Parameter$3},Workflow$3=[{_temporal:{changeLog:[],recordId:"151743c4-93ee-48ab-a7d3-608a5d06900e",validFrom:null,validTo:null,version:null},entityType:"WORKFLOW",id:"dd64cdb7-d089-48e0-8994-33dbc9ed6c4a",name:"Fork Test",endStep:"c6c463db-68bf-4e6f-aeaa-c546dae14525"}],Step$3=[{_temporal:{changeLog:[],recordId:"17bbc6b5-00c8-4aab-a9ca-05cdd38ab1ae",validFrom:null,validTo:null,version:null},description:"Ending point of the workflow",entityType:"STEP",fail:"c6c463db-68bf-4e6f-aeaa-c546dae14525",failsWorkflow:!1,id:"c6c463db-68bf-4e6f-aeaa-c546dae14525",name:"End",requireResumeKey:!1,success:"c6c463db-68bf-4e6f-aeaa-c546dae14525",timeout:0,type:"END",waitOnSuccess:!1,workflowId:"dd64cdb7-d089-48e0-8994-33dbc9ed6c4a"},{_temporal:{changeLog:[],recordId:"31f7d5cf-4799-4029-a4b8-45be79f33e3f",validFrom:null,validTo:null,version:null},async:!1,entityType:"STEP",failsWorkflow:!1,id:"4cc47451-7115-49b5-ace2-4d05fc3ad09c",name:"Fork",requireResumeKey:!1,timeout:0,type:"FORK",waitOnSuccess:!1,workflowId:"dd64cdb7-d089-48e0-8994-33dbc9ed6c4a"},{_temporal:{changeLog:[],recordId:"c9c1531e-ef6d-4199-b559-796fd144d983",validFrom:null,validTo:null,version:null},async:!0,entityType:"STEP",failsWorkflow:!1,id:"9417a242-0f72-4ef7-b876-61efb23ad446",name:"Fork Left",source:'console.log("===========");console.log("=========== Forking Left", name);console.log("===========")',requireResumeKey:!1,success:"aff95d33-9f8a-4ece-87f7-462d1b71eeb9",timeout:0,type:"BASIC",waitOnSuccess:!1,fork:"4cc47451-7115-49b5-ace2-4d05fc3ad09c",workflowId:"dd64cdb7-d089-48e0-8994-33dbc9ed6c4a"},{_temporal:{changeLog:[],recordId:"bbfe82e3-6ee6-4001-8ea6-2b00d932f2d3",validFrom:null,validTo:null,version:null},async:!1,entityType:"STEP",failsWorkflow:!1,id:"aff95d33-9f8a-4ece-87f7-462d1b71eeb9",name:"After Fork Left",source:'console.log("===========");console.log("=========== After Fork Left");console.log("===========")',requireResumeKey:!1,success:"c6c463db-68bf-4e6f-aeaa-c546dae14525",timeout:0,type:"BASIC",waitOnSuccess:!1,workflowId:"dd64cdb7-d089-48e0-8994-33dbc9ed6c4a"},{_temporal:{changeLog:[],recordId:"2a7f16df-3c7f-46ab-bdf9-9314a46c0c29",validFrom:null,validTo:null,version:null},async:!1,entityType:"STEP",failsWorkflow:!1,id:"44580253-4216-4fe1-9333-dcef4927280f",name:"Fork Right",source:'console.log("===========");console.log("=========== Forking Right");console.log("===========")',requireResumeKey:!1,success:"c6c463db-68bf-4e6f-aeaa-c546dae14525",timeout:0,type:"BASIC",waitOnSuccess:!1,fork:"4cc47451-7115-49b5-ace2-4d05fc3ad09c",workflowId:"dd64cdb7-d089-48e0-8994-33dbc9ed6c4a"},{_temporal:{changeLog:[],recordId:"ceff4a5d-3f73-4c63-8ba2-5fef6d65be28",validFrom:null,validTo:null,version:null},description:"Starting point of the workflow",entityType:"STEP",fail:"c6c463db-68bf-4e6f-aeaa-c546dae14525",failsWorkflow:!1,id:"3347466a-3abf-42c6-9fd7-3ddf22976af8",name:"Start",requireResumeKey:!1,success:"4cc47451-7115-49b5-ace2-4d05fc3ad09c",timeout:0,type:"START",waitOnSuccess:!1,workflowId:"dd64cdb7-d089-48e0-8994-33dbc9ed6c4a"}],Parameter$4=[{entityType:"PARAMETER",id:"912f5d3b-9d4f-4fe5-93f1-a6446b983ed5",name:"name",parentId:"9417a242-0f72-4ef7-b876-61efb23ad446",required:"false",scope:"STEP",class:"INPUT",type:"STRING"},{entityType:"PARAMETER",id:"3361dde6-3db4-4a4e-8b4f-58d7f8fd2a90",name:"name",parentId:"9417a242-0f72-4ef7-b876-61efb23ad446",required:"false",scope:"STEP",mapsTo:"93f439a5-9833-4706-9cd8-7acf19b01901",class:"OUTPUT",type:"STRING"},{entityType:"PARAMETER",id:"93f439a5-9833-4706-9cd8-7acf19b01901",name:"message",defaultValue:"Hello",parentId:"dd64cdb7-d089-48e0-8994-33dbc9ed6c4a",required:"false",scope:"WORKFLOW",class:"ATTRIBUTE",type:"STRING"}],ForkTest={Workflow:Workflow$3,Step:Step$3,Parameter:Parameter$4},Workflow$4=[{_temporal:{changeLog:[],recordId:"c5801b61-a7cd-4995-964b-c0a1f368de7c",validFrom:null,validTo:null,version:null},entityType:"WORKFLOW",id:"f4a8f894-06ba-4213-80f1-80ff72e1039b",name:"Hello World",endStep:"d2618ad7-a4d2-4213-b921-935b6eeafaf4"}],Step$4=[{_temporal:{changeLog:[],recordId:"2f703d65-3aa7-40fc-b99d-3a0610ee6645",validFrom:null,validTo:null,version:null},description:"Ending point of the workflow",entityType:"STEP",fail:"d2618ad7-a4d2-4213-b921-935b6eeafaf4",failsWorkflow:!1,id:"d2618ad7-a4d2-4213-b921-935b6eeafaf4",name:"End",requireResumeKey:!1,success:"d2618ad7-a4d2-4213-b921-935b6eeafaf4",timeout:0,type:"END",waitOnSuccess:!1,workflowId:"f4a8f894-06ba-4213-80f1-80ff72e1039b"},{_temporal:{changeLog:[],recordId:"e86715f1-11a4-402c-9aa3-1b7c61a4af8c",validFrom:null,validTo:null,version:null},async:!1,entityType:"STEP",failsWorkflow:!1,id:"68e5264a-89ef-4c85-9235-09d8e944580f",name:"Say Hello",requireResumeKey:!1,task:"4c35b5a7-e971-4719-9846-ca06db2f8eb2",versionArgs:{},success:"d2618ad7-a4d2-4213-b921-935b6eeafaf4",timeout:0,type:"TASK",waitOnSuccess:!1,workflowId:"f4a8f894-06ba-4213-80f1-80ff72e1039b"},{_temporal:{changeLog:[],recordId:"19a1e436-3532-4f51-8508-868d4f234bd2",validFrom:null,validTo:null,version:null},description:"Starting point of the workflow",entityType:"STEP",fail:"d2618ad7-a4d2-4213-b921-935b6eeafaf4",failsWorkflow:!1,id:"93a66216-21f5-45b5-92ae-f200a23c5c82",name:"Start",requireResumeKey:!1,success:"68e5264a-89ef-4c85-9235-09d8e944580f",timeout:0,type:"START",waitOnSuccess:!1,workflowId:"f4a8f894-06ba-4213-80f1-80ff72e1039b"}],Parameter$5=[{entityType:"PARAMETER",id:"a2189572-dce9-46b8-897f-18d5bb221c08",name:"name",parentId:"68e5264a-89ef-4c85-9235-09d8e944580f",required:"false",scope:"STEP",class:"INPUT",type:"STRING"},{entityType:"PARAMETER",id:"1e5782b6-e8c0-47c0-b4bc-a0eca56805c1",name:"message",defaultValue:"Hello",parentId:"f4a8f894-06ba-4213-80f1-80ff72e1039b",required:"false",scope:"WORKFLOW",class:"ATTRIBUTE",type:"STRING"}],HelloWorld={Workflow:Workflow$4,Step:Step$4,Parameter:Parameter$5},Workflow$5=[{_temporal:{changeLog:[],recordId:"2464780a-92ba-475b-b7a6-c49a0a9d189b",validFrom:null,validTo:null,version:null},entityType:"WORKFLOW",id:"de3f6477-aafb-49bb-9c88-ee3d7f65beff",name:"Sub Workflow Test",
endStep:"c3dd216f-aa42-472d-806e-7beaf48609ed"}],Step$5=[{_temporal:{changeLog:[],recordId:"9231a271-0f03-418d-ac9c-faa46c59506e",validFrom:null,validTo:null,version:null},description:"Starting point of the workflow",entityType:"STEP",fail:"c3dd216f-aa42-472d-806e-7beaf48609ed",failsWorkflow:!1,id:"68084694-e75a-45ab-816e-615c3c606596",name:"Start",requireResumeKey:!1,success:"6cb7a7e5-1c6c-468e-8106-29abeb585844",timeout:0,type:"START",waitOnSuccess:!1,workflowId:"de3f6477-aafb-49bb-9c88-ee3d7f65beff"},{_temporal:{changeLog:[],recordId:"a0c84a22-4bde-4ee7-abc9-f098b082bef0",validFrom:null,validTo:null,version:null},async:!1,entityType:"STEP",failsWorkflow:!1,id:"6cb7a7e5-1c6c-468e-8106-29abeb585844",name:"Test Name",source:'console.log("===========");console.log("Sub Workflow Start");console.log("===========");',requireResumeKey:!1,task:"5ca86058-4b93-4feb-8136-554195516cd1",success:"845a78a5-a2fa-422c-9cd5-806004be0038",timeout:0,type:"BASIC",waitOnSuccess:!1,workflowId:"de3f6477-aafb-49bb-9c88-ee3d7f65beff"},{_temporal:{changeLog:[],recordId:"4fb2fdd9-8698-4f97-ad37-19bfe9f05bad",validFrom:null,validTo:null,version:null},async:!1,entityType:"STEP",failsWorkflow:!1,id:"845a78a5-a2fa-422c-9cd5-806004be0038",name:"Hello World",requireResumeKey:!1,subWorkflow:"c5801b61-a7cd-4995-964b-c0a1f368de7c",success:"c3dd216f-aa42-472d-806e-7beaf48609ed",timeout:0,type:"WORKFLOW",waitOnSuccess:!1,workflowId:"de3f6477-aafb-49bb-9c88-ee3d7f65beff"},{_temporal:{changeLog:[],recordId:"94aa101f-4a8a-47a8-aae2-699cfeba541c",validFrom:null,validTo:null,version:null},description:"Ending point of the workflow",entityType:"STEP",fail:"c3dd216f-aa42-472d-806e-7beaf48609ed",failsWorkflow:!1,id:"c3dd216f-aa42-472d-806e-7beaf48609ed",name:"End",requireResumeKey:!1,success:"c3dd216f-aa42-472d-806e-7beaf48609ed",timeout:0,type:"END",waitOnSuccess:!1,workflowId:"de3f6477-aafb-49bb-9c88-ee3d7f65beff"}],Parameter$6=[{entityType:"PARAMETER",id:"1cf60c78-bfc9-4845-985c-343923f8c1d1",name:"name",parentId:"6cb7a7e5-1c6c-468e-8106-29abeb585844",required:"false",scope:"STEP",class:"INPUT",type:"STRING"},{entityType:"PARAMETER",id:"3fc2c440-5c1e-442f-9bfd-2250f88b2f0b",name:"message",defaultValue:"Hello",parentId:"de3f6477-aafb-49bb-9c88-ee3d7f65beff",required:"false",scope:"WORKFLOW",class:"ATTRIBUTE",type:"STRING"}],SubWorkflowTest={Workflow:Workflow$5,Step:Step$5,Parameter:Parameter$6},workflows=[ForkJoinTest,ForkTest,HelloWorld,SubWorkflowTest],Workflow$1=[],Step$1=[],Parameter$1=[],Task$1=[];_.forEach(_.union(workflows,tasks),function(e){_.isArray(e.Workflow)&&(Workflow$1=_.union(Workflow$1,e.Workflow)),_.isArray(e.Step)&&(Step$1=_.union(Step$1,e.Step)),_.isArray(e.Parameter)&&(Parameter$1=_.union(Parameter$1,e.Parameter)),_.isArray(e.Task)&&(Task$1=_.union(Task$1,e.Task))});var installData={Workflow:Workflow$1,Step:Step$1,Parameter:Parameter$1,Task:Task$1},asyncGenerator=function(){function e(e){this.value=e}function t(t){function r(e,t){return new Promise(function(r,o){var l={key:e,arg:t,resolve:r,reject:o,next:null};u?u=u.next=l:(a=u=l,n(e,t))})}function n(r,a){try{var u=t[r](a),l=u.value;l instanceof e?Promise.resolve(l.value).then(function(e){n("next",e)},function(e){n("throw",e)}):o(u.done?"return":"normal",u.value)}catch(e){o("throw",e)}}function o(e,t){switch(e){case"return":a.resolve({value:t,done:!0});break;case"throw":a.reject(t);break;default:a.resolve({value:t,done:!1})}a=a.next,a?n(a.key,a.arg):u=null}var a,u;this._invoke=r,"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},S2fRethinkDBBackend=function(e){function t(e,r,n){var o=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],a=arguments[4];classCallCheck(this,t),o=mergeConfig(o);var u={tables:temporalTables(o.types),prefix:_.get(o,"options.prefix"),db:_.get(o,"options.store")},l=new graphqlFactoryTemporal_backend.rethinkdb(n,r,u,a),i=FactoryTemporalPlugin(l);o.plugin=_.union([i],_.isArray(o.plugin)?o.plugin:[]);var s=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,n,o,a));return s.type="S2fRethinkDBBackend",s.addInstallData(installData),s.addFunctions(functions),s.addActions(actions(s)),s.addEvents(events),s}return inherits(t,e),t}(yellowjacket.YellowjacketRethinkDBBackend),index={rethinkdb:rethinkdb$1,S2fRethinkDBBackend:S2fRethinkDBBackend};exports.rethinkdb=rethinkdb$1,exports.S2fRethinkDBBackend=S2fRethinkDBBackend,exports.default=index;